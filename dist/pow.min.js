/**
 * @license MIT
 * @author IFYates <https://github.com/ifyates/pow.js>
 * @description A very small and lightweight templating framework.
 * @version 1.1.0
 */
export default(()=>{function t(t){let e=t.innerHTML,n=[...t.attributes],r={apply:o=>{if(r.$pow)return console.warn("Binding already in progress");r.$pow=1,window.$pow$={},t.innerHTML=e;for(let{name:e,value:r}of n)t.setAttribute(e,r);return f(t,{path:"*root",data:o,root:o}),delete r.$pow,r.refresh=()=>r.apply(o),r},refresh:()=>{}};return r}let e={apply:(e,n)=>t(e).apply(n),bind:t,_eval:(t,e)=>new Function(...e.map((t=>t[0])),`return ${t}`)(...e.map((t=>t[1])))};function n(t){t.removeAttribute("pow");return(t.content??t).querySelector("*[pow]:not([pow] [pow])")}function r(t,e=["item","array","if","ifnot"]){for(let n of e){let e=t.getAttribute(n);if(null!=e)return t.removeAttribute(n),{attr:n,token:e}}return{}}let o=/\{\{\s*(.*?)\s*\}\}/gs;function i(t,e,n){for(;n=o.exec(t);){let r=a(n[1],e)??"";o.lastIndex=n.index+`${r}`.length,t=t.slice(0,n.index)+r+t.slice(n.index+n[0].length)}return t}function a(t,n,r=t){try{let o="*"==t[0]&&(r=t.slice(1))?n:n?.data,i=e._eval(r,Object.entries(o||{}).filter((t=>isNaN(t[0]))));if("function"==typeof i){let t=`_${Math.random().toString(36).slice(2)}`;return window.$pow$[t]=t=>i.call(t,n.data,n.root),`$pow$.${t}(this)`}return i}catch(e){console.warn("Interpolation failed",{"*path":n.path,token:t},e)}}function s(t,e){if(t?.attributes.pow){let{attr:n,token:o}=r(t,["else-if","else-ifnot","else"]);if(n&&e)return t.remove(),!0;n&&"else"!=n&&t.setAttribute(n.slice(5),o)}}function f(t,e){let{attr:o,token:l}=r(t),c=l?a(l,e):e.data;if("if"==o||"ifnot"==o){for(;s(t.nextElementSibling,"if"==o!=!c););if("if"==o==!c)return t.remove()}else if("item"==o&&l)e={...e,path:`${e.path}.${l}`,data:c,parent:e.data};else if("array"==o&&"object"==typeof c){let n=Array.isArray(c)?c:Object.entries(c).map((([t,e])=>({key:t,value:e})));for(let r=0;r<n.length;++r){let o=t.cloneNode(1);t.parentNode.insertBefore(o,t),f(o,{...e,path:`${e.path}${l?`.${l}`:""}[${r}]`,index:r,first:!r,last:r>n.length-2,data:n[r],parent:e})}return t.remove()}for(var p;p=n(t);)f(p,e);for(let{name:n,value:r}of t.attributes)t.setAttribute(n,i(r,e));let u=i(t.innerHTML,e);t instanceof HTMLTemplateElement?(t.insertAdjacentHTML("afterend",u),t.remove()):t.innerHTML=u}return e})();