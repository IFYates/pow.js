/**
 * @license MIT
 * @author IFYates <https://github.com/ifyates/pow.js>
 * @description A very small and lightweight templating framework.
 * @version 2.0.0
 */
let e=(e,t,r)=>e.setAttribute(t,r),t=(e,t)=>e.removeAttribute(t),r=Math.random,n=(e,t)=>(e.content??e).querySelectorAll(t),a="array",o="else",i="if",l="ifnot",p="item",s="template",c=(e,r=[i,l,p,a,s],n)=>{if(n=r.find((t=>e.hasAttribute(t)))){let r=e.getAttribute(n);return t(e,n),{attr:n,expr:r}}},f=(e,t,r)=>h(e.replace(/{{\s*(.*?)\s*}}/gs,((e,r)=>u(r,t)??"")),r),u=(e,t)=>{try{let n=y._eval(e,{...t,...t.$data});if("function"==typeof n){let e=r();return window[t.$id][e]=e=>n.call(e,t.$data,t.$root),t.$id+"["+e+"](this)"}return n}catch(r){console.warn("Interpolation failed",{$path:t.$path,expr:e},r)}},$=(t,r)=>{if(t?.attributes.pow){let{attr:n,expr:a}=c(t,[o+"-"+i,o+"-"+l,o])||0;if(n&&r)return!t.remove();n&&n!=o&&e(t,n.slice(5),a)}},d=(e,t,r)=>{for(;$(e.nextElementSibling,t););return r|!t&&e.remove()},h=(e,t)=>t?e:e.replace(/({|p)({|ow)/g,"$1​$2​"),m=(r,o,$,w=o.$path.length<6)=>{for(let{name:n,value:a}of[...r.attributes].filter((e=>":"==e.name[0])))t(r,n),(a=u(a,o))&&e(r,n.slice(1),h(a,w));let{attr:y,expr:g}=c(r)||0;if(y==s&&($=document.getElementById(g))){let e=$.cloneNode(1);return r.parentNode.replaceChild(e,r),m(e,o)}if($=g?u(g,o):o.$data,y==i|y==l)return d(r,y==i!=!$);if(y==p&&g){if(null==$)return r.remove();o={...o,$path:o.$path+"."+g,$data:$,$parent:o.$data}}else if(y==a){$=!$|Array.isArray($)?$:Object.entries($).map((([e,t])=>({key:e,value:t})));for(let e=0;e<$?.length;++e){let t=r.cloneNode(1);r.parentNode.insertBefore(t,r),m(t,{...o,$path:o.$path+(g?"."+g:"")+"["+e+"]",$index:e,$first:!e,$last:e>$.length-2,$data:$[e],$parent:o})}return d(r,$?.length,1)}for(t(r,"pow");$=n(r,"*[pow]:not([pow] [pow])")[0];)m($,o);for(let{name:n,value:a}of[...r.attributes])(a=f(a,o,w))?e(r,n,a):t(r,n);$=f(r.innerHTML,o,w),r instanceof HTMLTemplateElement?(r.insertAdjacentHTML("afterend",$),r.remove()):r.innerHTML=$},w=t=>{let a=t.innerHTML,o=[...t.attributes],i="$pow_"+r().toString(36).slice(2),l={apply:r=>{if(l.$pow)return console.warn("Binding already in progress");l.$pow=1,t.innerHTML=a,o.forEach((r=>e(t,r.name,r.value))),window[i]={};for(let e of n(t,"*[pow][stop]"))e.outerHTML=h(e.outerHTML);try{m(t,{$id:i,$path:"$root",$data:r,$root:r})}finally{t.innerHTML=t.innerHTML.replace(/​/g,""),delete l.$pow}return l.refresh=()=>l.apply(r),l},refresh:()=>{}};return l},y={apply:(e,t)=>w(e).apply(t),bind:w,_eval:(e,t)=>{let r=Object.entries(t).filter((e=>isNaN(e[0])));return new Function(...r.map((e=>e[0])),"return "+e).call(t.$data,...r.map((e=>e[1])))}};export default y;