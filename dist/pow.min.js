/**
 * @license MIT
 * @author IFYates <https://github.com/ifyates/pow.js>
 * @description A very small and lightweight templating framework.
 * @version 2.0.0
 */
let e=(e,t,r)=>e.setAttribute(t,r),t=(e,t)=>e.removeAttribute(t),r=Math.random,n=(e,t)=>(e.content??e).querySelectorAll(t),a="array",o="data",i="else",l="if",p="ifnot",c="template",s=(e,r=[l,p,c,o,a],n)=>{for(let{name:n,value:a}of[...e.attributes])if(r.includes(n))return t(e,n),{attr:n,expr:a}},u=(e,t,r)=>h(e.replace(/{{\s*(.*?)\s*}}/gs,((e,r)=>$(r,t)??"")),r),f=e=>e.$parent?{...e.$data,...e,$parent:f(e.$parent)}:{...e.$data,...e},$=(e,t,n=f(t))=>{try{let a=g._eval(e,n);if("function"==typeof a){let e=r();return window[t.$id][e]=e=>a.call(e,n),t.$id+"["+e+"](this)"}return a}catch(r){console.warn("Interpolation failed",{$path:t.$path,expr:e},r)}},d=(t,r)=>{if(t?.attributes.pow){let{attr:n,expr:a}=s(t,[i+"-"+l,i+"-"+p,i])||0;if(n&&r)return!t.remove();n&&n!=i&&e(t,n.slice(5),a)}},m=(e,t,r)=>{for(;d(e.nextElementSibling,t););return r|!t&&e.remove()},h=(e,t)=>t?e:e.replace(/({|p)({|ow)/g,"$1​$2​"),w=(r,i,f,d)=>{for(let e of n(r,"*[pow][stop]"))e.replaceWith(document.createRange().createContextualFragment(h(e.outerHTML)));for(let{name:n,value:a}of[...r.attributes].filter((e=>":"==e.name[0])))t(r,n),(a=$(a,i))&&e(r,n.slice(1),h(a,f));let{attr:y,expr:g}=s(r)||0;if(y==c)return(d=document.getElementById(g))&&(r.innerHTML=d.cloneNode(1).innerHTML),w(r,i);if(d=g?$(g,i):i.$data,y==l|y==p)return d&&w(r,i,f),m(r,y==l!=!d);if(y==o&&g)return null==d?r.remove():w(r,{...i,$path:i.$path+"."+g,$data:d,$parent:i},f);if(y==a){d=!d|Array.isArray(d)?d:Object.entries(d).map((([e,t])=>({key:e,value:t})));for(let e=0;e<d?.length;++e){let t=r.cloneNode(1);r.parentNode.insertBefore(t,r),w(t,{...i,$path:i.$path+(g?"."+g:"")+"["+e+"]",$index:e,$first:!e,$last:e>d.length-2,$data:d[e],$array:d,$parent:i})}return m(r,d?.length,1)}for(t(r,"pow");d=n(r,"*[pow]:not([pow] [pow])")[0];)w(d,i);for(let{name:n,value:a}of[...r.attributes])(a=u(a,i,f))?e(r,n,a):t(r,n);r.innerHTML=u(r.innerHTML,i,f),"TEMPLATE"==r.tagName&&r.replaceWith(...r.content.childNodes)},y=t=>{let n=t.innerHTML,a=[...t.attributes],o="$pow_"+r().toString(36).slice(2),i={apply:r=>{if(i.$pow)return console.warn("Binding already in progress");i.$pow=1,t.innerHTML=n,a.forEach((r=>e(t,r.name,r.value))),window[o]={};try{let e={$id:o,$data:r,$path:"$root"};w(t,{...e,$root:e},1)}finally{t.innerHTML=t.innerHTML.replace(/​/g,""),delete i.$pow}return i.refresh=()=>i.apply(r),i},refresh:()=>{}};return i},g={apply:(e,t)=>y(e).apply(t),bind:y,_eval:(e,t)=>{let r=Object.entries(t).filter((e=>isNaN(e[0])));return new Function(...r.map((e=>e[0])),"return "+e).call(t.$data,...r.map((e=>e[1])))}};export default g;