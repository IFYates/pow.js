export default(()=>{function t(t,n){const r=["item","array","else","else-if","else-ifnot","if","ifnot"].find((e=>t.hasAttribute(e))),o=t.getAttribute(r);return t.removeAttribute(r),{attr:r,path:o,value:o&&n?e(n,o):void 0}}function e(t,e){try{var n;if("*"==e[0]?((t={...t}).parent=t.parent?.data,n=new Function("return this."+e.slice(1)).call(t)):n=new Function("return this."+e).call(t.data),"function"==typeof n){const e=n,r=`_${Math.random().toString(36).slice(2)}`;return globalThis.$pow$[r]=n=>e.call(n,t.data,t.root),`$pow$.${r}(this)`}return n}catch(n){console.warn("Interpolation failed",t.path,e,n)}}function n(e,n){if(e?.hasAttribute("pow")&&["else-if","else-ifnot","else"].some((t=>e.hasAttribute(t)))){if(n)return e.remove(),!0;const{attr:r,condition:o}=t(e);"else"!=r&&e.setAttribute(r.slice(5),o)}}function r(e,o){const{attr:i,path:s,value:l}=t(e,o);if("if"==i||"ifnot"==i){const t="if"==i?!!l:!l;for(;n(e.nextElementSibling,t););if(!t)return void e.remove()}else if("item"==i){if(o={path:o.path+"."+(s||e.id||""),data:s?l:o.data,parent:s?o:o.parent,root:o.root},s&&void 0===o.data)return void console.warn("Template binding without data",o.path)}else if("array"==i&&"object"==typeof o.data){const t=Array.isArray(l)?l:Object.entries(l).map((([t,e])=>({$key:t,$value:e})));for(var c=0;c<t.length;++c){const n=e.cloneNode(!0);e.parentNode.insertBefore(n,e),r(n,{path:o.path+"["+c+"]",index:c,first:0==c,last:c==t.length-1,data:t[c],parent:o,root:o.root})}return void e.remove()}const u=function(t){t.removeAttribute("pow");const e=t.content??t;return Array.from(e.querySelectorAll("*[pow]:not([pow] [pow])"))}(e);for(const t of u)r(t,o);for(const{name:t,value:n}of e.attributes)e.setAttribute(t,a(n,o));const f=a(e.innerHTML,o);e instanceof HTMLTemplateElement?e.outerHTML=f:e.innerHTML=f}const o=/\{\{\s*(\*?[\$\w]+(\.\*?[\$\w]+)*.*?)\s*\}\}/g;function a(t,n,r){for(;r=o.exec(t);){const a=e(n,r[1]);void 0===a?console.warn("Placeholder not resolved",n.path,r[1]):o.lastIndex=r.index+`${a}`.length,t=t.substring(0,r.index)+(a??"")+t.slice(r.index+r[0].length)}return t}function i(t){const e=t.innerHTML,n=[...t?.attributes||[]].map((({name:t,value:e})=>[t,e])),o={remove:()=>range?.deleteContents};var a=!1;return o.apply=i=>{if(a)return console.warn("Binding already in progress");a=!0,globalThis.$pow$={},t.innerHTML=e;for(const[e,r]of n)t.setAttribute(e,r);return r(t,{path:"$",data:i,root:i}),a=!1,o},o}return{apply:(t,e)=>i(t).apply(e),bind:i}})();