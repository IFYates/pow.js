/**
 * @license MIT
 * @author IFYates <https://github.com/ifyates/pow.js>
 * @description A very small and lightweight templating framework.
 * @version 1.4.2
 */
let e=document,t=window,r=(e,t=["if","ifnot","item","array","template"])=>{for(let r of t.filter((t=>e.hasAttribute(t)))){let t=e.getAttribute(r);return e.removeAttribute(r),{attr:r,expr:t}}return 0},n=(e,t)=>(e.content??e).querySelectorAll(t),a=(e,t)=>p(e.replace(/{{\s*(.*?)\s*}}/gs,((e,r)=>o(r,t)??"")),t.root==t.data),o=(e,r,n=e)=>{try{let a="*"==e[0]&&(n=e.slice(1))?r:r.data,o=u._eval(n,a);if("function"==typeof o){let e=Math.random();return t[r.id][e]=e=>o.call(e,r.data,r.root),`${r.id}[${e}](this)`}return o}catch(t){console.warn("Interpolation failed",{"*path":r.path,expr:e},t)}},i=(e,t)=>{if(e?.attributes.pow){let{attr:n,expr:a}=r(e,["else-if","else-ifnot","else"]);if(n&&t)return!e.remove();n&&"else"!=n&&e.setAttribute(n.slice(5),a)}},l=(e,t,r)=>{for(;i(e.nextElementSibling,t););return r|!t&&e.remove()},p=(e,t)=>t?e:e.replace(/({|p)({|ow)/g,"$1​$2​"),s=(t,i,c,u)=>{for(let r of n(t,"*[pow][stop]"))r.replaceWith(e.createRange().createContextualFragment(p(r.outerHTML)));let{attr:f,expr:d}=r(t);if("template"==f&&(u=e.getElementById(d))){let e=u.cloneNode(1);return t.parentNode.replaceChild(e,t),s(e,i)}if(u=d?o(d,i):i.data,"if"==f||"ifnot"==f)return l(t,"if"==f!=!u);if("item"==f&&d){if(null==u)return t.remove();i={...i,path:`${i.path}.${d}`,data:u,parent:i.data}}else if("array"==f){u=!u||Array.isArray(u)?u:Object.entries(u).map((([e,t])=>({key:e,value:t})));for(let e=0;e<u?.length;++e){let r=t.cloneNode(1);t.parentNode.insertBefore(r,t),s(r,{...i,path:`${i.path}${d?`.${d}`:""}[${e}]`,index:e,first:!e,last:e>u.length-2,data:u[e],parent:i})}return l(t,u?.length,1)}for(t.removeAttribute("pow");u=n(t,"*[pow]:not([pow] [pow])")[0];)s(u,i);for(let{name:e,value:r}of[...t.attributes])":"==e[0]?(t.removeAttribute(e),(r=o(r,i))&&t.setAttribute(e.slice(1),p(r,c))):(r=a(r,i))?t.setAttribute(e,r):t.removeAttribute(e);u=a(t.innerHTML,i),"TEMPLATE"==t.tagName?(t.insertAdjacentHTML("afterend",u),t.remove()):t.innerHTML=u},c=e=>{let r=e.innerHTML,n=[...e.attributes],a=`$pow_${Math.random().toString(36).slice(2)}`,o={apply:i=>{if(o.$pow)return console.warn("Binding already in progress");o.$pow=1,e.innerHTML=r,n.forEach((t=>e.setAttribute(t.name,t.value))),t[a]={};try{s(e,{id:a,path:"*root",data:i,root:i},1)}finally{delete o.$pow}return e.innerHTML=e.innerHTML.replace(/​/g,""),o.refresh=()=>o.apply(i),o},refresh:()=>{}};return o},u={apply:(e,t)=>c(e).apply(t),bind:c,_eval:(e,t)=>{let r=Object.entries(t||{}).filter((e=>isNaN(e[0])));return new Function(...r.map((e=>e[0])),`return ${e}`).call(t,...r.map((e=>e[1])))}};export default u;