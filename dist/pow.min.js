/**
 * @license MIT
 * @author IFYates <https://github.com/ifyates/pow.js>
 * @description A very small and lightweight templating framework.
 * @version 2.0.0
 */
let e=(e,t,r)=>e.setAttribute(t,r),t=(e,t)=>e.removeAttribute(t),r=Math.random,n=(e,t)=>(e.content??e).querySelectorAll(t),a=(e,r=["if","ifnot","item","array","template"])=>{for(let n of r.filter((t=>e.hasAttribute(t)))){let r=e.getAttribute(n);return t(e,n),{attr:n,expr:r}}return 0},o=(e,t,r)=>s(e.replace(/{{\s*(.*?)\s*}}/gs,((e,r)=>i(r,t)??"")),r),i=(e,t)=>{try{let n=c._eval(e,{...t,...t.$data});if("function"==typeof n){let e=r();return window[t.$id][e]=e=>n.call(e,t.$data,t.$root),`${t.$id}[${e}](this)`}return n}catch(r){console.warn("Interpolation failed",{$path:t.$path,expr:e},r)}},l=(t,r)=>{if(t?.attributes.pow){let{attr:n,expr:o}=a(t,["else-if","else-ifnot","else"]);if(n&&r)return!t.remove();n&&"else"!=n&&e(t,n.slice(5),o)}},p=(e,t,r)=>{for(;l(e.nextElementSibling,t););return(r||!t)&&e.remove()},s=(e,t)=>t?e:e.replace(/({|p)({|ow)/g,"$1​$2​"),$=(r,l,f,c=l.$path.length<6)=>{for(let{name:n,value:a}of[...r.attributes].filter((e=>":"==e.name[0])))t(r,n),(a=i(a,l))&&e(r,n.slice(1),s(a,c));let{attr:u,expr:d}=a(r);if("template"==u&&(f=document.getElementById(d))){let e=f.cloneNode(1);return r.parentNode.replaceChild(e,r),$(e,l)}if(f=d?i(d,l):l.$data,"if"==u||"ifnot"==u)return p(r,"if"==u!=!f);if("item"==u&&d){if(null==f)return r.remove();l={...l,$path:`${l.$path}.${d}`,$data:f,$parent:l.$data}}else if("array"==u){f=!f||Array.isArray(f)?f:Object.entries(f).map((([e,t])=>({key:e,value:t})));for(let e=0;e<f?.length;++e){let t=r.cloneNode(1);r.parentNode.insertBefore(t,r),$(t,{...l,$path:`${l.$path}${d?`.${d}`:""}[${e}]`,$index:e,$first:!e,$last:e>f.length-2,$data:f[e],$parent:l})}return p(r,f?.length,1)}for(t(r,"pow");f=n(r,"*[pow]:not([pow] [pow])")[0];)$(f,l);for(let{name:n,value:a}of[...r.attributes])(a=o(a,l,c))?e(r,n,a):t(r,n);f=o(r.innerHTML,l,c),r instanceof HTMLTemplateElement?(r.insertAdjacentHTML("afterend",f),r.remove()):r.innerHTML=f},f=t=>{let a=t.innerHTML,o=[...t.attributes],i=`$pow_${r().toString(36).slice(2)}`,l={apply:r=>{if(l.$pow)return console.warn("Binding already in progress");l.$pow=1,t.innerHTML=a,o.forEach((r=>e(t,r.name,r.value))),window[i]={};for(let e of n(t,"*[pow][stop]"))e.outerHTML=s(e.outerHTML);try{$(t,{$id:i,$path:"$root",$data:r,$root:r})}finally{delete l.$pow}return t.innerHTML=t.innerHTML.replace(/​/g,""),l.refresh=()=>l.apply(r),l},refresh:()=>{}};return l},c={apply:(e,t)=>f(e).apply(t),bind:f,_eval:(e,t)=>{let r=Object.entries(t).filter((([e])=>isNaN(e)));return new Function(...r.map((e=>e[0])),`return ${e}`).call(t.$data,...r.map((e=>e[1])))}};export default c;