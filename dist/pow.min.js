export default(()=>{function t(t,n,a=!1){const r=["item","array","else","else-if","else-ifnot","if","ifnot"].find((e=>t.hasAttribute(e))),o=t.getAttribute(r),i=o&&a?e(n,o):void 0;return console.debug(n?.path,t.tagName,r,o,i),t.removeAttribute(r),{attr:r,path:o,value:i}}function e(t,e){const n=e?.split(".")??[];for(var a=0;a<n.length;++a){const e=n[a];if(["*first","*index","*last","*parent","*path","*root"].includes(e))t={data:t[e.slice(1)]};else if("*index1"==e)t={data:null!=t.index?t.index+1:void 0};else if("*true"==e||"*false"==e)t={data:"*true"==e};else if(e&&t.data?.hasOwnProperty(e))t={data:t.data[e]};else if("length"!=e||Array.isArray(t.data)){if("*data"!=e)return}else t={data:Object.keys(t.data).length}}return e?t.data:void 0}function n(e,n){if(e?.hasAttribute("pow")&&["else-if","else-ifnot","else"].some((t=>e.hasAttribute(t)))){if(n)return e.remove(),!0;const{attr:a,condition:r}=t(e);"else"!=a&&e.setAttribute(a.slice(5),r)}}function a(o,i){const{attr:l,path:s,value:d}=t(o,i,!0);if("if"==l||"ifnot"==l){const t="if"==l?!!d:!d;for(;n(o.nextElementSibling,t););if(!t)return void o.remove()}else if("item"==l){if(i={path:i.path+"."+(s||o.id||""),data:s?d:i.data,parent:s?i:i.parent,root:i.root},s&&void 0===i.data)return void console.warn("Template binding without data",i.path)}else if("array"==l&&"object"==typeof i.data){const t=d instanceof Array?d:Object.entries(d).map((([t,e])=>({$key:t,$value:e}))),e=o.innerHTML;for(var f=0;f<t.length;++f)o.innerHTML=e,a(o,{path:i.path+"["+f+"]",index:f,first:0==f,last:f==t.length-1,data:t[f],parent:i,root:i.root});return void o.remove()}const u=function(t){t.removeAttribute("pow");const e=t.content??t;return Array.from(e.querySelectorAll("*[pow]:not([pow] [pow])"))}(o);for(const t of u)a(t,i),t.remove();o.innerHTML=function(t,n){var a;for(;a=r.exec(t);){var o=e(n,a[1]);if(void 0===o)console.warn("Placeholder not resolved",n.path,a[1]);else{if("function"==typeof o&&a.index>2&&'="'==t.slice(a.index-2,a.index)&&'"'==t[a.index+a[0].length]){const t=o,e=`$pow$${Math.random().toString(36).slice(2)}`;globalThis[e]=e=>t.call(e,n.data,n.root),o=`${e}(this)`}r.lastIndex=a.index+`${o}`.length}t=t.substring(0,a.index)+(null!=o?o:"")+t.slice(a.index+a[0].length)}return t}(o.innerHTML,i)}const r=/\{\{\s*((?:\*)?[\$\w]+(?:\.(?:\*)?[\$\w]+)*)\s*\}\}/g;function o(t){const e=t.outerHTML,n={remove:()=>range?.deleteContents,apply:r=>(t.outerHTML=e,a(t,{path:"$",data:r,root:r}),n)};return n}return{apply:(t,e)=>o(t).apply(e),bind:o}})();