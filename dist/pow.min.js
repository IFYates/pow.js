/**
 * @license MIT
 * @author IFYates <https://github.com/ifyates/pow.js>
 * @description A very small and lightweight templating framework.
 * @version 1.0.0
 */
export default(()=>{function t(t,e=["item","array","if","ifnot"]){for(let n of e){let e=t.getAttribute(n);if(null!=e)return t.removeAttribute(n),{attr:n,token:e}}return{}}let e=/\{\{\s*(!*\*?[\$\w]+(\.\*?[\$\w]+)*.*?)\s*\}\}/g;function n(t,n,o){for(;o=e.exec(t);){let a=r(o[1],n);e.lastIndex=o.index+`${a}`.length,t=t.substring(0,o.index)+(a??"")+t.slice(o.index+o[0].length)}return t}function r(t,e){try{let n=Array.isArray(e.data)||"string"==typeof e.data?[]:Object.entries({...e.data});n.push(["$",e]);let r=`return ${"*"==t[0]?"$."+t.slice(1):t}`,o=new Function(...n.map((t=>t[0])),r)(...n.map((t=>t[1])));if("function"==typeof o){let t=`_${Math.random().toString(36).slice(2)}`;return window.$pow$[t]=t=>o.call(t,e.data,e.root),`$pow$.${t}(this)`}return o}catch(n){console.warn("Interpolation failed",{"*path":e.path,token:t},n)}}function o(e,n){if(e?.attributes.pow){let{attr:r,token:o}=t(e,["else-if","else-ifnot","else"]);if(r&&n)return e.remove(),!0;r&&"else"!=r&&e.setAttribute(r.slice(5),o)}}function a(e,i){let{attr:s,token:f}=t(e),c=f&&i?r(f,i):i.data;if("if"==s||"ifnot"==s){for(;o(e.nextElementSibling,"if"==s==c););if("if"==s!=c)return e.remove()}else if("item"==s&&f)i={path:`${i.path}.${f}`,data:c,parent:i.data,root:i.root};else if("array"==s&&"object"==typeof c){let t=Array.isArray(c)?c:Object.entries(c).map((([t,e])=>({key:t,value:e})));for(let n=0;n<t.length;++n){let r=e.cloneNode(1);e.parentNode.insertBefore(r,e),a(r,{path:`${i.path}${f?`.${f}`:""}[${n}]`,index:n,first:!n,last:n>t.length-2,data:t[n],parent:i,root:i.root})}return e.remove()}for(let t of function(t){return t.removeAttribute("pow"),[...(t.content??t).querySelectorAll("*[pow]:not([pow] [pow])")]}(e))a(t,i);for(let{name:t,value:r}of e.attributes)e.setAttribute(t,n(r,i));let l=n(e.innerHTML,i);e instanceof HTMLTemplateElement?(e.insertAdjacentHTML("afterend",l),e.remove()):e.innerHTML=l}function i(t){let e=t.innerHTML,n=[...t.attributes],r={apply:o=>{if(r.$pow)return console.warn("Binding already in progress");r.$pow=1,window.$pow$={},t.innerHTML=e;for(let{name:e,value:r}of n)t.setAttribute(e,r);return a(t,{path:"*root",data:o,root:o}),delete r.$pow,r.refresh=()=>r.apply(o),r},refresh:()=>{}};return r}return{apply:(t,e)=>i(t).apply(e),bind:i}})();
