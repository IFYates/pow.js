<h1>Syntax / Bindings</h1>

<hr />
<p>
    <template pow template="pow"></template> exposes two functions for binding an element hierarchy:
</p>
<ul>
    <li><code class="js">apply(element, data)</code> Applies the data to the given element hierarchy and returns the
        binding object.</li>
    <li><code class="js">bind(element)</code> Returns a binding object for the given element hierarchy, without making
        any changes.</li>
</ul>
<p>
    The binding object exposes the following functions for subsequent use:
</p>
<ul>
    <li><code class="js">apply(data)</code> Applies data to the bound element hierarchy.</li>
    <li><code class="js">refresh()</code> Reapplies the last used data to the bound element hierarchy.</li>
</ul>

<p>
    The data is applied to the entire element hierarchy; with additional binding only being resolved on elements
    that have a <code class="pow">pow</code> attribute.
</p>

<p>
    The possible binding attributes are:
</p>
<ul>
    <li pow if="version(1.4)"><a href="#stop"><code class="attr">stop</code></a> Disable further evaluation of this
        element hierarchy.</li>
    <li>
        <template pow template="nav" data="'bindings-conditions'">
            <code class="attr">if</code>
            <code class="attr">ifnot</code>
            <code class="attr">else</code>
            <code pow ifnot="version(3.0)" class="attr">else-if</code>
            <code pow ifnot="version(3.0)" class="attr">else-ifnot</code></template>
        Conditional elements.
    </li>
    <li><a href="#data"><code class="attr">{{ version(2.0) ? 'data' : 'item' }}</code></a> Change the data context of
        the current element.</li>
    <li>
        <pow:nav template="nav" data="{ id: 'bindings-loops' }"><code class="attr">array</code></pow:nav>
        Repeat this element
        for each item in the array.
    </li>
    <li pow if="version(1.2)">
        <pow:nav template="nav" data="{ id: 'bindings-templates' }"><code class="attr">template</code></pow:nav>
        Insert a named template.
        <ul pow if="version(2.2)">
            <li>
                This can be simplified by using a
                <pow:nav template="nav" data="{ id: 'features-custom' }"><template>custom element</template></pow:nav>
            </li>
        </ul>
    </li>
    <li pow if="version(3.1)"><a href="#transform"><code class="attr">transform</code></a> Tranform a bound element
        after all <pow:pow></pow:pow> processing has completed.</li>
</ul>

<p pow if="version(1.0, 1.2)">
    Elements may only have one binding attribute.
</p>

<block pow if="version(1.2)" id="order">
    <h2>Processing order</h2>

    <p pow if="version(2.0)">
        The attributes are processed in the order they appear in the element.<br />
        This means that the context of an <code class="attr">if</code> attribute is affected by whether it comes before
        or after a <code class="attr">data</code>/<code class="attr">array</code> attribute on the same element.
    </p>
    <p pow else>
        The above is also the order that they will be evaluated in; so, the context of an <code class="attr">if</code>
        will not be altered by any <code class="attr">item</code>/<code class="attr">array</code> expression on the
        same element.
    </p>
    <div class="example">
        <pre class="example-data"><code class="js">{ child: { text: 'Hello, world!' } }</code></pre>
        <pre class="live-example">&lt;div>
    &lt;span <span class="pow">pow</span> <span class="attr">if</span>="<span class="expr">child</span>" <span class="attr">{{ version(2.0) ? 'data' : 'item' }}</span>="<span class="expr">child</span>">
        <span pow stop class="expr">{{ text }}</span>
    &lt;/span>
&lt;/div></pre>
        <pre></pre>
        <pre class="live-example">&lt;div>
    &lt;span <span class="pow">pow</span> <span class="attr">{{ version(2.0) ? 'data' : 'item' }}</span>="<span class="expr">child</span>" <span class="attr">if</span>="<span class="expr">child</span>">
        <span pow stop class="expr">{{ text }}</span>
    &lt;/span>
&lt;/div></pre>
        <pre></pre>
    </div>
</block>

<block id="data">
    <h2><code
            class="html"><span class="attr">{{ version(2.0) ? 'data' : 'item' }}</span>="<span class="expr">expression</span>"</code>
    </h2>

    <p>
        Sets the data context for the binding of the hierarchy from this element.
    </p>
    <div class="example">
        <pre class="example-data"><code class="js">{ child: { text: 'Hello, world!' } }</code></pre>
        <pre class="live-example">&lt;div <span class="pow">pow</span> <span class="attr">{{ version(2.0) ? 'data' : 'item' }}</span>="<span class="expr">child</span>">
    <span pow stop class="expr">{{ text }}</span>
&lt;/div></pre>
        <pre></pre>
    </div>

    <p>
        Because the attribute takes an expression, the value does not have to be in the data context.
    </p>
    <div class="example">
        <pre class="live-example">&lt;div <span class="pow">pow</span> <span class="attr">{{ version(2.0) ? 'data' : 'item' }}</span>="<span class="expr">{ text: 'Hello, world!' }</span>">
    <span pow stop class="expr">{{ text }}</span>
&lt;/div></pre>
        <pre></pre>
    </div>

    <p pow if="version(1.3)">
        If the expresson evaluates to <code class="js">null</code>, the element will not be rendered.
    </p>
    <p pow else>
        If the expresson evaluates to <code class="js">null</code>, the element will be rendered without a data context.
    </p>
    <div class="example">
        <pre class="live-example">&lt;div>
    &lt;span <span class="pow">pow</span> <span class="attr">{{ version(2.0) ? 'data' : 'item' }}</span>="<span class="expr">null</span>">
        {{ version(2.0) ? '{{ $path }'+'}' : '{{ *path }'+'}' }}
        Content: {{ version(2.0) ? '{{ $data }'+'}' : '{{ *data }'+'}' }}
    &lt;/span>
&lt;/div></pre>
        <pre></pre>
    </div>

    <template pow if="version(3.0)">
        <p>
            The <pow:nav id:="'bindings-conditions'" hash:="'else'" text:="'else'"></pow:nav> binding can be used to
            render an element if the binding expression evaluates to <code class="js">null</code>.
        </p>
        <div class="example">
            <pre class="live-example">&lt;div>
    &lt;span <span class="pow">pow</span> <span class="attr">data</span>="<span class="expr">1</span>">Has <span pow stop class="expr">{{ $data }}</span>&lt;/span>
    &lt;span <span class="pow">pow</span> <span class="attr">else</span>>No data&lt;/span>
&lt;/div>
&lt;div>
    &lt;span <span class="pow">pow</span> <span class="attr">data</span>="<span class="expr">null</span>">Has <span pow stop class="expr">{{ $data }}</span>&lt;/span>
    &lt;span <span class="pow">pow</span> <span class="attr">else</span>>No data&lt;/span>
&lt;/div></pre>
            <pre></pre>
        </div>
    </template>
</block>

<block pow if="version(1.4)" id="stop">
    <h2><code class="attr">stop</code></h2>

    <p>
        Prevents any further bindings from being applied to the element hierarchy.
    </p>
    <div class="example">
        <pre class="live-example"><code pow stop>&lt;div <span class="pow">pow</span> <span class="attr">stop</span>>
    {{ text }}
&lt;/div></code></pre>
        <pre></pre>
    </div>
    <p>
        If an explicit call to <code class="js">apply()</code> is made for this element, the
        <code class="attr">stop</code> attribute will be ignored and the hierarchy will be processed.
    </p>
    <div class="example">
        <pre class="live-example"><code pow stop>&lt;div <span class="pow">pow</span> <span class="attr">stop</span>>
    {{ text }}
&lt;/div></code></pre>
        <pre style="grid-row: span 2"></pre>
        <pre class="example-code">&lt;script type="module">
<span class="js">    import pow from 'https://ifyates.github.io/pow.js/v{{ activeVersion }}/pow.min.js'
    pow.apply(document.body, { text: 'Body text' })
    pow.apply(document.querySelector('div[stop]'), { text: 'Child text' })
</span>&lt;/script></pre>
    </div>
    <p>
        This enables you to apply a different binding to part of an element hierarchy that has already been bound.
    </p>
</block>

<block pow if="version(3.1)" id="transform">
    <h2><code class="html"><span class="attr">transform</span>="<span class="expr">function</span>"</code></h2>

    <p>
        The <code class="expr">function</code> is invoked after all <pow:pow></pow:pow> processing has completed for the
        element, and receives the current element as an argument and the current context as arguments.
    </p>
    <div class="example">
        <pre
            class="example-data"><code class="js">{ upperCase: (el, context) => el.innerHTML = context.$path + ' :: ' + el.innerHTML.toUpperCase() }</code></pre>
        <pre class="live-example"><code>&lt;div>
    &lt;template <span class="pow">pow</span> <span class="attr">transform</span>="<span class="expr">upperCase</span>">
        Hello, world!
    &lt;/template>
&lt;/div></code></pre>
        <pre></pre>
    </div>

    <p>
        The value of <code class="expr">function</code> must return a <code class="js">function</code>. Any other result
        will be ignored, including expressions.
    </p>
    <div class="example">
        <pre class="live-example"><code>&lt;div>
    &lt;template <span class="pow">pow</span> <span class="attr">transform</span>="<span pow stop class="expr">'Removed'</span>">
        Non-function expression
    &lt;/template>
&lt;/div>
&lt;div>
    &lt;template <span class="pow">pow</span> <span class="attr">transform</span>="<span pow stop class="expr">{{ '() => el.innerHTML = `Removed`' }}</span>">
        Expression function
    &lt;/template>
&lt;/div></code></pre>
        <pre></pre>
    </div>
</block>

<block id="templates">
    <h2>Template elements</h2>

    <p>
        Most examples use <code class="html">&lt;div&gt;</code> elements to clearly show how it will appear in the
        result, but if the bound element is a <code class="html">&lt;template&gt;</code>, the entire element is
        replaced.<br />
        This is a good way to hide unprocessed elements until rendering is complete.
    </p>
    <div class="example">
        <pre class="live-example"><code pow stop>&lt;div>
    &lt;template <span class="pow">pow</span>>
        Hello, world!
    &lt;/template>
&lt;/div></code></pre>
        <pre></pre>
    </div>
</block>